<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="description" content="CTO, Development"><title>Data Models for Modern Frontend Applications &mdash; Vladimir Semenyuk</title><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/images/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,300italic" rel="stylesheet" type="text/css"><link rel="stylesheet" type="text/css" href="/styles/style.css"><link rel="stylesheet" type="text/css" href="/styles/post.css"></head><body><div class="header"> <a class="header__link" href="/"><div class="header__portrait"></div><div></div><h1 class="header__name">Vladimir Semenyuk</h1></a><div class="header__description">CTO at Wroom.online</div><a class="mail" href="mailto:mail@vsemenyuk.pro"></a><a class="fb" href="https://www.facebook.com/vladimir.semenyuk.31" target="_blank"></a><a class="in" href="https://www.linkedin.com/in/vladimir-semenyuk-9b417871" target="_blank"></a><a class="git" href="https://github.com/VladimirSemenyuk/" target="_blank"></a><a class="tele" href="https://telegram.me/vladimirsemenyuk" target="_blank"></a></div><div class="body"> <!--div(id='fb-root')--><div class="post"><div class="post__header"><h1 class="post__title">Data Models for Modern Frontend Applications</h1><div class="post__meta"><div class="post__date clndr">2016 Aug 15</div><div class="post__categories category">Development</div><div class="post__tags tags">JavaScript, TypeScript</div></div></div><div class="post__content"><p>There is a bunch of popular frameworks, which gives you a way to create and manipulate data model.
For example, Backbone, Ember, and some others.
But modern JavaScript gives you the opportunity to create simple yet powerful models in minutes.</p>
<p>In first part of this article we will see how to do it. While the second part will show us the power
of TypeScript in the same task. You will also learn how to create property decorators.</p>
<p>Let’s start!</p>
<h2 id="part-1-javascript-way">Part 1. JavaScript Way</h2>
<p>So, let’s create a model class named <code>Person</code>, which has 2 public properties: <code>name</code> and <code>surname</code>.</p>
<figure class="highlight javascript"><figcaption><span>Person.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name, surname</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.surname = surname;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Pretty simple, yeah?</p>
<p>Let’s add a computed property <code>fullname</code>. We will use <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">Object.defineProperty()</a>.
This is a cool cross-browser feature, which has been implemented even in IE 9.
It gives you the opportunity to set accessors without creating <code>.get()</code> and <code>.set()</code> methods.</p>
<figure class="highlight javascript"><figcaption><span>Person.js continuation</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.defineProperty(Person.prototype, <span class="string">'fullname'</span>, &#123;</div><div class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">' '</span> + <span class="keyword">this</span>.surname; </div><div class="line">    &#125;,</div><div class="line">    enumerable: <span class="literal">true</span>,</div><div class="line">    configurable: <span class="literal">false</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> john = <span class="keyword">new</span> Person(<span class="string">'John'</span>, <span class="string">'Snow'</span>);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(john.fullname); <span class="comment">// =&gt; 'John Snow'</span></div></pre></td></tr></table></figure>
<p>Pay your attention to a fact that you should create property in Person.prototype instead of
instance, because this property is actually a getter, so it is a function.</p>
<p>Look how this getter works. It calculates <code>fullname</code> every time you try to get it. Let’s create some caching to avoid redundant computations.
This feature requires dependencies (<code>name</code> and <code>surname</code>) to change cached value.
I suggest to create special <code>property()</code> and <code>computed()</code> functions to bind computeds and dependencies together.</p>
<figure class="highlight javascript"><figcaption><span>property.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">property</span>(<span class="params">target, propName</span>) </span>&#123;</div><div class="line">    target.prototype._depsMap = target.prototype._depsMap || &#123;&#125;;</div><div class="line">    target.prototype._getters = target.prototype._getters || &#123;&#125;;</div><div class="line"></div><div class="line">    <span class="built_in">Object</span>.defineProperty(target.prototype, propName, &#123;</div><div class="line">        set: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123; </div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (value !== <span class="keyword">this</span>._cached[propName]) &#123;</div><div class="line">                <span class="keyword">this</span>._cached[propName] = value;</div><div class="line"></div><div class="line">                <span class="keyword">var</span> deps = <span class="keyword">this</span>._depsMap[propName];</div><div class="line">                </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; deps.length; i++) &#123;</div><div class="line">                    <span class="keyword">this</span>._cached[deps[i]] = <span class="keyword">this</span>._getters[deps[i]].call(<span class="keyword">this</span>);</div><div class="line">                &#125;      </div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._cached[propName]; </div><div class="line">        &#125;,</div><div class="line">        enumerable: <span class="literal">true</span>,</div><div class="line">        configurable: <span class="literal">true</span></div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>computed.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">computed</span>(<span class="params">target, propName, depsArr, getter</span>) </span>&#123;</div><div class="line">    target.prototype._depsMap = target.prototype._depsMap || &#123;&#125;;</div><div class="line">    target.prototype._getters = target.prototype._getters || &#123;&#125;;</div><div class="line"></div><div class="line">    target.prototype._getters[propName] = getter;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; depsArr.length; i++) &#123;</div><div class="line">        <span class="keyword">var</span> dep = depsArr[i];</div><div class="line"></div><div class="line">        target.prototype._depsMap[dep] = target.prototype._depsMap[dep] || [];</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (target.prototype._depsMap[dep].indexOf(propName) === <span class="number">-1</span>) &#123;</div><div class="line">            target.prototype._depsMap[dep].push(propName);</div><div class="line">        &#125;</div><div class="line">    &#125; </div><div class="line"></div><div class="line">    <span class="built_in">Object</span>.defineProperty(target.prototype, propName, &#123;</div><div class="line">        get: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._cached[propName];</div><div class="line">        &#125;,</div><div class="line">        enumerable: <span class="literal">true</span>,</div><div class="line">        configurable: <span class="literal">true</span></div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In these functions we created service prototype properties:</p>
<ul>
<li><code>_depsMap</code> to store information about relations between computeds and dependencies,</li>
<li><code>_getters</code> to store original getters of computeds.</li>
</ul>
<p>One should mention that both of <code>property()</code> and <code>computed()</code> are actually property decorators.</p>
<p>Now <code>Person</code> model should be described like this:</p>
<figure class="highlight javascript"><figcaption><span>Person.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Person = <span class="function"><span class="keyword">function</span>(<span class="params">name, surname</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.name = name;</div><div class="line">    <span class="keyword">this</span>.surname = surname;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">property(Person, <span class="string">'name'</span>);</div><div class="line">property(Person, <span class="string">'surname'</span>);</div><div class="line">computed(Person, <span class="string">'fullname'</span>, [<span class="string">'name'</span>, <span class="string">'surname'</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name + <span class="string">' '</span> + <span class="keyword">this</span>.surname;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Hooray! Now we have simple but awesome model without any frameworks and libraries.</p>
<h2 id="part-2-typescript-way">Part 2. TypeScript Way</h2>
<p>OK. Now Let’s do the same thing using cool TypeScript features.</p>
<p>Simple <code>Person</code> class will look like this:</p>
<figure class="highlight typescript"><figcaption><span>Person.ts</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Person &#123;</div><div class="line">    <span class="keyword">public</span> name: <span class="built_in">string</span>;</div><div class="line">    <span class="keyword">public</span> surname: <span class="built_in">string</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">get</span> fullname():<span class="built_in">string</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;this.name&#125;</span> <span class="subst">$&#123;this.surname&#125;</span>`</span>; </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">constructor</span>(name: string, surname: string) &#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.surname = surname;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>I have mentioned that <code>property()</code> and <code>computed()</code> from part 1 are decorators.
Typescript has very convenient style of creating and using decorators.
You can get more info in <a href="http://blog.wolksoftware.com/decorators-reflection-javascript-typescript" target="_blank" rel="external">this article</a>.</p>
<p>I should say that decorators are still an experimental TS feature.
The compiler must be run with <code>--experimentalDecorators</code> flag.</p>
<p>So these are new functions:</p>
<figure class="highlight typescript"><figcaption><span>property.ts</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">property</span>(<span class="params">target: <span class="built_in">any</span>, propName: <span class="built_in">string</span></span>) </span>&#123;</div><div class="line">    target._depsMap = target._depsMap || &#123;&#125;;</div><div class="line">    target._getters = target._getters || &#123;&#125;;</div><div class="line">    </div><div class="line">    <span class="built_in">Object</span>.defineProperty(target, propName, &#123;</div><div class="line">        <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123; </div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (value !== <span class="keyword">this</span>._cached[propName]) &#123;</div><div class="line">                <span class="keyword">this</span>._cached[propName] = value;</div><div class="line"></div><div class="line">                <span class="keyword">let</span> deps = <span class="keyword">this</span>._depsMap[propName];</div><div class="line">                </div><div class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> dep of deps) &#123;</div><div class="line">                    <span class="keyword">this</span>._cached[dep] = <span class="keyword">this</span>._getters[dep].call(<span class="keyword">this</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._cached[propName]; </div><div class="line">        &#125;,</div><div class="line">        enumerable: <span class="literal">true</span>,</div><div class="line">        configurable: <span class="literal">true</span></div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight typescript"><figcaption><span>computed.ts</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">computed</span>(<span class="params">...deps: <span class="built_in">Array</span>&lt;<span class="built_in">string</span>&gt;</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, propName, descriptor: TypedPropertyDescriptor&lt;<span class="built_in">any</span>&gt;</span>) </span>&#123;</div><div class="line">        target._depsMap = target._depsMap || &#123;&#125;;</div><div class="line">        target._getters = target._getters || &#123;&#125;;</div><div class="line">        </div><div class="line">        target._getters[propName] = descriptor.get;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> dep of deps) &#123;</div><div class="line">            target._depsMap[dep] = target._depsMap[dep] || [];</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (target._depsMap[dep].indexOf(propName) === <span class="number">-1</span>) &#123;    </div><div class="line">                target._depsMap[dep].push(propName);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        descriptor.get = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>._cached = <span class="keyword">this</span>._cached || &#123;&#125;;</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._cached[propName];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> descriptor;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Actually, these decorators are the same stuff as in JavaScript part.</p>
<p>And here is an updated <code>Person</code> class. Look at a very convenient ‘@-blabla’ notation.
This is how decorators are applied in TypeScript.</p>
<figure class="highlight typescript"><figcaption><span>Person.ts</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Person &#123; </div><div class="line">    @property</div><div class="line">    <span class="keyword">public</span> name: <span class="built_in">string</span>;</div><div class="line">    </div><div class="line">    @property</div><div class="line">    <span class="keyword">public</span> surname: <span class="built_in">string</span>;</div><div class="line">    </div><div class="line">    @computed(<span class="string">'name'</span>, <span class="string">'surname'</span>)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">get</span> fullname(): <span class="built_in">string</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;this.name&#125;</span> <span class="subst">$&#123;this.surname&#125;</span>`</span>; </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">constructor</span>(name: string, surname: string) &#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.surname = surname;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure> 
<h2 id="conclusion">Conclusion</h2>
<p>In this post I’ve described a method to design data models without any frameworks.</p>
<p>You can add lots of other features to your models using these approach.
For example, you can add <code>observable()</code> decorator paired with <code>.onchange()</code> and <code>.off()</code> methods
to implement event emitter pattern.</p>
</div><!-- .post__comments--><!--     .fb-comments(data-href!=page.link data-width='1050' data-numposts='3')--></div></div><div class="info"></div></body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-82311544-1', 'auto');
ga('send', 'pageview');</script></html>